# 更新指南

本文档提供了翼龙对接魔方财务模块的更新指南和注意事项，帮助您顺利完成模块更新。

## 更新前准备

在更新模块前，请务必完成以下准备工作：

1. **备份数据**：备份魔方财务系统的数据库和文件
2. **备份配置文件**：特别是模块目录下的env.php文件
   ```
   /public/plugins/servers/ydpterodactyl/env.php
   ```
3. **检查兼容性**：确认新版本与您的魔方财务系统版本兼容

## 更新步骤

1. 下载最新版本的模块
2. 上传到服务器的临时目录
3. 解压缩文件
4. 备份原有模块目录（可选但推荐）
   ```bash
   cp -r /public/plugins/servers/ydpterodactyl /public/plugins/servers/ydpterodactyl_backup
   ```
5. 将新版本文件复制到模块目录
6. **重要**：检查并恢复env.php文件
   ```bash
   cp /path/to/backup/env.php /public/plugins/servers/ydpterodactyl/env.php
   ```
7. 检查文件权限，确保web服务器有适当的读写权限

## 特别注意事项

### env.php文件问题

::: danger 重要警告
更新包中可能包含默认的env.php文件，直接覆盖会导致严重问题！
:::

**问题描述**：
如果更新时覆盖了原有的env.php文件，可能会导致以下问题：
- 新开通的产品能正常开通，但无法进行任何管理
- 管理页面提示"处理此请求时遇到意外错误，请再试一次"
- 用户无法访问服务器控制台和其他功能

**原因**：
- 更新包中的env.php包含默认Token
- 覆盖后，新开通用户的密钥与系统中的不匹配
- 导致API请求验证失败

**解决方案**：
1. 使用之前备份的env.php替换更新后的文件
2. 如果没有备份，需要重新配置正确的Token
3. 参考[Token配置指南](/token-configuration)重新设置

### 其他可能的更新问题

1. **权限问题**：更新后检查文件权限，确保web服务器可以正常读写
2. **缓存问题**：清除魔方财务系统缓存和浏览器缓存
3. **数据库结构变更**：某些版本可能需要更新数据库结构，请关注更新说明

## 更新后验证

完成更新后，请执行以下验证步骤：

1. 检查模块是否正常显示在魔方财务后台
2. 尝试开通一个新的服务，确认可以正常创建
3. 测试服务管理功能，包括启动、停止、重启等操作
4. 验证控制台、文件管理器等功能是否正常工作

## 版本更新日志

请关注官方渠道获取最新的版本更新日志和功能说明。

## 遇到问题？

如果您在更新过程中遇到任何问题，请参考[常见问题解答](/faq)或联系技术支持。

技术支持QQ：1666633881 